# Design: åœ–æ›¸é¤¨å€Ÿé–±ç®¡ç†ç³»çµ±

## Context
é€™æ˜¯åœ–æ›¸é¤¨ç®¡ç†ç³»çµ±çš„ç¬¬äºŒéšæ®µåŠŸèƒ½ï¼Œå»ºç«‹åœ¨ç¬¬ä¸€éšæ®µï¼ˆåœ–æ›¸è³‡è¨Šç®¡ç†ï¼‰çš„åŸºç¤ä¸Šã€‚æœ¬è¨­è¨ˆæ–‡ä»¶å°ˆæ³¨æ–¼**å€Ÿé–±ç®¡ç†**åŠŸèƒ½ï¼ŒåŒ…æ‹¬å€Ÿé–±ã€æ­¸é‚„ã€çºŒå€Ÿå’Œé€¾æœŸç®¡ç†ã€‚

### èƒŒæ™¯
- ç›®æ¨™ä½¿ç”¨è€…ï¼šåœ–æ›¸é¤¨ç®¡ç†å“¡å’Œè®€è€…
- ç¾æœ‰ç³»çµ±ï¼šå·²å®Œæˆåœ–æ›¸è³‡è¨Šç®¡ç†ï¼ˆlibrary_management æ¨¡çµ„ï¼‰
- æŠ€è¡“ç’°å¢ƒï¼šOdoo 19, PostgreSQL
- éƒ¨ç½²ä½ç½®ï¼šæ“´å±• `custom_addons/library_management/` æ¨¡çµ„

### ç´„æŸæ¢ä»¶
- å¿…é ˆéµå®ˆ Odoo 19 é–‹ç™¼è¦ç¯„å’Œå°ˆæ¡ˆæ²»ç†å±¤åŸå‰‡
- å¿…é ˆåƒè€ƒ Odoo åŸå§‹ç¢¼ï¼ˆç‰¹åˆ¥æ˜¯ `sale` å’Œ `stock` æ¨¡çµ„ï¼‰è¨­è¨ˆç‹€æ…‹ç®¡ç†
- å¿…é ˆä½¿ç”¨ Odoo 19 æ–°èªæ³•ï¼ˆå¦‚ `models.Constraint`, `fields.Command`ï¼‰
- å¿…é ˆèˆ‡ç¾æœ‰çš„ `library.book` æ¨¡å‹æ•´åˆ
- å¿…é ˆæ”¯æ´å¤šä½¿ç”¨è€…å’Œæ¬Šé™æ§åˆ¶

## Goals / Non-Goals

### Goals
- âœ… æä¾›å®Œæ•´çš„å€Ÿé–± CRUD åŠŸèƒ½
- âœ… è‡ªå‹•ç®¡ç†æ›¸ç±åº«å­˜ï¼ˆå€Ÿé–±æ™‚æ‰£æ¸›ï¼Œæ­¸é‚„æ™‚å¢åŠ ï¼‰
- âœ… æ”¯æ´çºŒå€ŸåŠŸèƒ½ï¼Œä¸¦é™åˆ¶çºŒå€Ÿæ¬¡æ•¸
- âœ… è‡ªå‹•è¨ˆç®—åˆ°æœŸæ—¥å’Œé€¾æœŸå¤©æ•¸
- âœ… æä¾›é€¾æœŸæé†’å’Œéæ¿¾åŠŸèƒ½
- âœ… æ•´åˆ Odoo è¨Šæ¯è¿½è¹¤åŠŸèƒ½ï¼ˆmail.threadï¼‰
- âœ… å¯¦ä½œé©ç•¶çš„è³‡æ–™é©—è­‰å’Œç´„æŸ
- âœ… è¨­å®šæ¬Šé™æ§åˆ¶ï¼ˆç®¡ç†å“¡ vs ä¸€èˆ¬ä½¿ç”¨è€…ï¼‰
- âœ… æä¾›ç›´è§€çš„ä½¿ç”¨è€…ä»‹é¢ï¼ˆåˆ—è¡¨ã€è¡¨å–®ã€çœ‹æ¿ã€æœå°‹ï¼‰

### Non-Goals
- âŒ è®€è€…æœƒå“¡ç®¡ç†ï¼ˆä½¿ç”¨ Odoo æ¨™æº–çš„ res.partnerï¼‰
- âŒ é€¾æœŸç½°æ¬¾è¨ˆç®—ï¼ˆå°‡åœ¨å¾ŒçºŒè®Šæ›´ä¸­å¯¦ä½œï¼‰
- âŒ é ç´„å’Œæ’éšŠåŠŸèƒ½ï¼ˆå°‡åœ¨å¾ŒçºŒè®Šæ›´ä¸­å¯¦ä½œï¼‰
- âŒ æ›¸ç±æ¨è–¦åŠŸèƒ½ï¼ˆæœªä¾†å¯è€ƒæ…®ï¼‰
- âŒ èˆ‡å¤–éƒ¨åœ–æ›¸é¤¨ç³»çµ±æ•´åˆï¼ˆæœªä¾†å¯è€ƒæ…®ï¼‰

## Decisions

### 1. è³‡æ–™æ¨¡å‹è¨­è¨ˆ

#### æ±ºç­–ï¼šä½¿ç”¨å–®ä¸€ `library.borrowing` æ¨¡å‹
- **æ¨¡å‹åç¨±**: `library.borrowing`
- **ç”¨é€”**: è¨˜éŒ„æ‰€æœ‰å€Ÿé–±äº¤æ˜“ï¼ŒåŒ…æ‹¬å€Ÿé–±ä¸­å’Œå·²æ­¸é‚„çš„è¨˜éŒ„

**ç†ç”±**ï¼š
- ç°¡åŒ–è¨­è¨ˆï¼Œæ˜“æ–¼æŸ¥è©¢å’Œçµ±è¨ˆ
- ç‹€æ…‹æ¬„ä½å¯æ¸…æ¥šå€åˆ†ä¸åŒéšæ®µ
- æ­·å²è¨˜éŒ„å®Œæ•´ä¿ç•™ï¼Œä¾¿æ–¼è¿½è¹¤å’Œåˆ†æ
- ç¬¦åˆ Odoo æœ€ä½³å¯¦è¸ï¼ˆå¦‚ `sale.order` çš„è¨­è¨ˆï¼‰

#### æ›¿ä»£æ–¹æ¡ˆè€ƒæ…®ï¼š
- **æ–¹æ¡ˆ A**: åˆ†é›¢ã€Œç•¶å‰å€Ÿé–±ã€å’Œã€Œå€Ÿé–±æ­·å²ã€å…©å€‹æ¨¡å‹
  - âŒ å¢åŠ è¤‡é›œåº¦ï¼Œéœ€è¦åœ¨æ­¸é‚„æ™‚ç§»å‹•è³‡æ–™
  - âŒ æŸ¥è©¢çµ±è¨ˆæ™‚éœ€è¦åˆä½µå…©å€‹æ¨¡å‹çš„è³‡æ–™
- **æ–¹æ¡ˆ B**: åœ¨ `library.book` ä¸­ç›´æ¥è¨˜éŒ„å€Ÿé–±è³‡è¨Š
  - âŒ ç„¡æ³•ä¿ç•™æ­·å²è¨˜éŒ„
  - âŒ ç„¡æ³•æ”¯æ´åŒä¸€æœ¬æ›¸çš„å¤šæ¬¡å€Ÿé–±è¨˜éŒ„

### 2. å€Ÿé–±è€…ç®¡ç†ç­–ç•¥

#### æ±ºç­–ï¼šä½¿ç”¨ Odoo æ¨™æº–çš„ `res.partner` æ¨¡å‹
- å€Ÿé–±è¨˜éŒ„çš„ `partner_id` æ¬„ä½åƒç…§ `res.partner`
- ä¸å»ºç«‹ç¨ç«‹çš„ã€Œè®€è€…ã€æˆ–ã€Œæœƒå“¡ã€æ¨¡å‹

**ç†ç”±**ï¼š
- åˆ©ç”¨ Odoo ç¾æœ‰çš„è¯çµ¡äººç®¡ç†åŠŸèƒ½
- é¿å…é‡è¤‡é–‹ç™¼å’Œè³‡æ–™å†—é¤˜
- å¯ç›´æ¥ä½¿ç”¨ Odoo çš„è¯çµ¡äººæœå°‹å’Œéæ¿¾åŠŸèƒ½
- æœªä¾†å¯è¼•é¬†æ“´å±•ï¼ˆå¦‚æ·»åŠ æœƒå“¡ç­‰ç´šã€ç©åˆ†ç­‰ï¼‰

#### æ›¿ä»£æ–¹æ¡ˆè€ƒæ…®ï¼š
- **æ–¹æ¡ˆ A**: å»ºç«‹ç¨ç«‹çš„ `library.member` æ¨¡å‹
  - âŒ å¢åŠ é–‹ç™¼å’Œç¶­è­·æˆæœ¬
  - âŒ èˆ‡ Odoo ç”Ÿæ…‹ç³»çµ±æ•´åˆåº¦è¼ƒä½
  - ğŸ’¡ æœªä¾†å¦‚éœ€ç‰¹æ®Šæœƒå“¡åŠŸèƒ½ï¼Œå¯ç¹¼æ‰¿ `res.partner` æ·»åŠ æ¬„ä½

### 3. åº«å­˜ç®¡ç†ç­–ç•¥

#### æ±ºç­–ï¼šå€Ÿé–±æ™‚è‡ªå‹•æ›´æ–° `library.book` çš„ `available_quantity`
- å€Ÿé–±å‹•ä½œï¼š`available_quantity -= 1`
- æ­¸é‚„å‹•ä½œï¼š`available_quantity += 1`
- å–æ¶ˆå‹•ä½œï¼šå¦‚å°šæœªæ­¸é‚„ï¼Œ`available_quantity += 1`

**ç†ç”±**ï¼š
- å³æ™‚åæ˜ åº«å­˜ç‹€æ…‹
- èˆ‡ç¬¬ä¸€éšæ®µçš„åº«å­˜è¨­è¨ˆä¸€è‡´
- ç°¡å–®ç›´è§€ï¼Œæ˜“æ–¼ç†è§£å’Œç¶­è­·
- é˜²æ­¢è¶…å€Ÿï¼ˆå€Ÿé–±å‰æª¢æŸ¥ `available_quantity > 0`ï¼‰

#### æ›¿ä»£æ–¹æ¡ˆè€ƒæ…®ï¼š
- **æ–¹æ¡ˆ A**: ä½¿ç”¨è¨ˆç®—æ¬„ä½å‹•æ…‹è¨ˆç®—å¯å€Ÿé–±æ•¸é‡
  - âŒ æ•ˆèƒ½è¼ƒå·®ï¼ˆéœ€è¦çµ±è¨ˆæ‰€æœ‰å€Ÿé–±è¨˜éŒ„ï¼‰
  - âŒ è¤‡é›œåº¦è¼ƒé«˜
- **æ–¹æ¡ˆ B**: æ•´åˆ Odoo çš„ `stock` æ¨¡çµ„
  - âŒ éåº¦è¤‡é›œï¼Œåœ–æ›¸é¤¨ä¸éœ€è¦å®Œæ•´çš„åº«å­˜ç®¡ç†åŠŸèƒ½
  - âŒ å¢åŠ ä¸å¿…è¦çš„ä¾è³´

### 4. ç‹€æ…‹ç®¡ç†è¨­è¨ˆ

#### æ±ºç­–ï¼šä½¿ç”¨ Selection æ¬„ä½ç®¡ç†å€Ÿé–±ç‹€æ…‹
ç‹€æ…‹æµç¨‹ï¼š
```
draft (è‰ç¨¿) â†’ borrowed (å€Ÿé–±ä¸­) â†’ returned (å·²æ­¸é‚„)
                    â†“
                cancelled (å·²å–æ¶ˆ)
```

ç‹€æ…‹å®šç¾©ï¼š
- `draft`: è‰ç¨¿ï¼ˆæ–°å»ºä½†å°šæœªç¢ºèªï¼‰
- `borrowed`: å€Ÿé–±ä¸­ï¼ˆå·²å€Ÿå‡ºï¼Œå°šæœªæ­¸é‚„ï¼‰
- `returned`: å·²æ­¸é‚„ï¼ˆå€Ÿé–±å®Œæˆï¼‰
- `cancelled`: å·²å–æ¶ˆï¼ˆå–æ¶ˆå€Ÿé–±ï¼‰

**ç†ç”±**ï¼š
- æ¸…æ™°çš„ç‹€æ…‹æµç¨‹ï¼Œæ˜“æ–¼è¿½è¹¤
- ç¬¦åˆ Odoo æ¨™æº–æ¨¡å¼ï¼ˆåƒè€ƒ `sale.order`ï¼‰
- æ”¯æ´è‰ç¨¿ç‹€æ…‹ï¼Œå…è¨±é å…ˆå»ºç«‹å€Ÿé–±è¨˜éŒ„
- å–æ¶ˆç‹€æ…‹ä¿ç•™è¨˜éŒ„ï¼Œä¾¿æ–¼å¯©è¨ˆ

### 5. æ—¥æœŸå’ŒæœŸé™ç®¡ç†

#### æ±ºç­–ï¼šä½¿ç”¨ä¸‰å€‹æ—¥æœŸæ¬„ä½ + è‡ªå‹•è¨ˆç®—
- `borrow_date`: å€Ÿé–±æ—¥æœŸï¼ˆDateï¼Œé è¨­ä»Šå¤©ï¼‰
- `due_date`: åˆ°æœŸæ—¥ï¼ˆDateï¼Œè‡ªå‹•è¨ˆç®—ï¼‰
- `return_date`: æ­¸é‚„æ—¥æœŸï¼ˆDateï¼Œæ­¸é‚„æ™‚å¡«å¯«ï¼‰

è¨ˆç®—é‚è¼¯ï¼š
- `due_date = borrow_date + é è¨­å€Ÿé–±å¤©æ•¸ï¼ˆ14 å¤©ï¼‰`
- `overdue_days = max(0, today - due_date)` ï¼ˆå¦‚å°šæœªæ­¸é‚„ï¼‰
- çºŒå€Ÿï¼š`due_date += çºŒå€Ÿå»¶é•·å¤©æ•¸ï¼ˆ14 å¤©ï¼‰`

**ç†ç”±**ï¼š
- è‡ªå‹•åŒ–ç®¡ç†ï¼Œæ¸›å°‘äººå·¥éŒ¯èª¤
- éˆæ´»çš„çºŒå€Ÿæ©Ÿåˆ¶
- æ¸…æ¥šçš„é€¾æœŸè¨ˆç®—
- å¯é…ç½®çš„å€Ÿé–±æœŸé™

#### æ›¿ä»£æ–¹æ¡ˆè€ƒæ…®ï¼š
- **æ–¹æ¡ˆ A**: ä½¿ç”¨ Datetime è€Œé Date
  - âŒ åœ–æ›¸é¤¨é€šå¸¸ä»¥ã€Œå¤©ã€ç‚ºå–®ä½ï¼Œä¸éœ€è¦ç²¾ç¢ºåˆ°æ™‚é–“
  - âŒ å¢åŠ è¤‡é›œåº¦
- **æ–¹æ¡ˆ B**: æ‰‹å‹•è¼¸å…¥åˆ°æœŸæ—¥
  - âŒ å®¹æ˜“å‡ºéŒ¯
  - âŒ ä¸ä¸€è‡´çš„å€Ÿé–±æœŸé™

### 6. çºŒå€Ÿè¦å‰‡è¨­è¨ˆ

#### æ±ºç­–ï¼šé™åˆ¶çºŒå€Ÿæ¬¡æ•¸ï¼Œå¾åŸåˆ°æœŸæ—¥å»¶é•·
- æœ€å¤§çºŒå€Ÿæ¬¡æ•¸ï¼š2 æ¬¡ï¼ˆå¯é…ç½®ï¼‰
- çºŒå€Ÿå»¶é•·å¤©æ•¸ï¼š14 å¤©ï¼ˆå¯é…ç½®ï¼‰
- çºŒå€Ÿè¨ˆç®—ï¼š`new_due_date = current_due_date + 14 å¤©`
- çºŒå€Ÿæ¢ä»¶ï¼š
  - ç‹€æ…‹ç‚ºã€Œå€Ÿé–±ä¸­ã€
  - çºŒå€Ÿæ¬¡æ•¸ < æœ€å¤§çºŒå€Ÿæ¬¡æ•¸
  - ï¼ˆæœªä¾†å¯æ·»åŠ ï¼‰ç„¡å…¶ä»–äººé ç´„

**ç†ç”±**ï¼š
- å…¬å¹³åˆ†é…åœ–æ›¸è³‡æº
- å¾åŸåˆ°æœŸæ—¥å»¶é•·ï¼Œé¿å…ç„¡é™å»¶æœŸ
- å¯é…ç½®çš„è¦å‰‡ï¼Œé©æ‡‰ä¸åŒåœ–æ›¸é¤¨æ”¿ç­–
- ç‚ºæœªä¾†çš„é ç´„åŠŸèƒ½é ç•™ä»‹é¢

#### æ›¿ä»£æ–¹æ¡ˆè€ƒæ…®ï¼š
- **æ–¹æ¡ˆ A**: å¾ç•¶å‰æ—¥æœŸå»¶é•·
  - âŒ å¯èƒ½å°è‡´ç„¡é™å»¶æœŸ
  - âŒ å°é€¾æœŸæ­¸é‚„çš„è®€è€…éæ–¼å¯¬å®¹
- **æ–¹æ¡ˆ B**: ä¸é™åˆ¶çºŒå€Ÿæ¬¡æ•¸
  - âŒ å¯èƒ½å°è‡´æ›¸ç±é•·æœŸè¢«ä½”ç”¨
  - âŒ å½±éŸ¿å…¶ä»–è®€è€…çš„å€Ÿé–±æ©Ÿæœƒ

### 7. è¦–åœ–è¨­è¨ˆç­–ç•¥

#### æ±ºç­–ï¼šåƒè€ƒ Odoo `sale.order` çš„è¦–åœ–çµæ§‹
- è¡¨å–®è¦–åœ–ï¼šä½¿ç”¨ header + sheet + chatter çµæ§‹
- åˆ—è¡¨è¦–åœ–ï¼šä½¿ç”¨ decoration æ¨™ç¤ºé€¾æœŸè¨˜éŒ„
- çœ‹æ¿è¦–åœ–ï¼šä¾ç‹€æ…‹åˆ†çµ„é¡¯ç¤º
- æœå°‹è¦–åœ–ï¼šæä¾›å¤šç¶­åº¦éæ¿¾å’Œåˆ†çµ„

**ç†ç”±**ï¼š
- ç¬¦åˆ Odoo æ¨™æº– UX æ¨¡å¼ï¼Œä½¿ç”¨è€…ç†Ÿæ‚‰
- éµå®ˆå°ˆæ¡ˆæ²»ç†å±¤è¦æ±‚ï¼ˆåƒè€ƒæ¨™æº–æ¨¡çµ„ï¼‰
- æä¾›ä¸€è‡´çš„ä½¿ç”¨è€…é«”é©—

#### é—œéµè¦–åœ–å…ƒç´ ï¼š
1. **è¡¨å–®è¦–åœ–**ï¼š
   - Headerï¼šç‹€æ…‹åˆ— + å‹•ä½œæŒ‰éˆ•ï¼ˆå€Ÿé–±ã€æ­¸é‚„ã€çºŒå€Ÿã€å–æ¶ˆï¼‰
   - Sheetï¼šå€Ÿé–±è³‡è¨Šï¼ˆå€Ÿé–±è€…ã€æ›¸ç±ã€æ—¥æœŸï¼‰
   - Chatterï¼šè¨Šæ¯è¿½è¹¤å’Œæ´»å‹•

2. **åˆ—è¡¨è¦–åœ–**ï¼š
   - Decorationï¼š`decoration-danger="is_overdue"` æ¨™ç¤ºé€¾æœŸ
   - Decorationï¼š`decoration-success="state == 'returned'"` æ¨™ç¤ºå·²æ­¸é‚„
   - é¡¯ç¤ºé—œéµè³‡è¨Šï¼šå€Ÿé–±è€…ã€æ›¸ç±ã€åˆ°æœŸæ—¥ã€ç‹€æ…‹

3. **çœ‹æ¿è¦–åœ–**ï¼š
   - ä¾ç‹€æ…‹åˆ†çµ„ï¼ˆå€Ÿé–±ä¸­ã€å·²æ­¸é‚„ã€é€¾æœŸï¼‰
   - å¡ç‰‡é¡¯ç¤ºï¼šå€Ÿé–±è€…ã€æ›¸ç±ã€åˆ°æœŸæ—¥
   - å¿«é€ŸæŸ¥çœ‹é€¾æœŸæƒ…æ³

### 8. æ¬Šé™è¨­è¨ˆ

#### æ±ºç­–ï¼šå…©å±¤æ¬Šé™ + è¨˜éŒ„è¦å‰‡
- **Library User** (group_library_user): ä¸€èˆ¬ä½¿ç”¨è€…
  - å¯æŸ¥çœ‹è‡ªå·±çš„å€Ÿé–±è¨˜éŒ„
  - å¯è«‹æ±‚çºŒå€Ÿï¼ˆéœ€ç®¡ç†å“¡ç¢ºèªï¼‰
  
- **Library Manager** (group_library_manager): åœ–æ›¸ç®¡ç†å“¡
  - å¯ç®¡ç†æ‰€æœ‰å€Ÿé–±è¨˜éŒ„
  - å¯åŸ·è¡Œå€Ÿé–±ã€æ­¸é‚„ã€çºŒå€Ÿã€å–æ¶ˆæ“ä½œ

è¨˜éŒ„è¦å‰‡ï¼š
- User: `[('partner_id', '=', user.partner_id.id)]`
- Manager: `[(1, '=', 1)]` (æ‰€æœ‰è¨˜éŒ„)

**ç†ç”±**ï¼š
- ä¿è­·å€‹äººéš±ç§ï¼ˆä½¿ç”¨è€…åªèƒ½çœ‹åˆ°è‡ªå·±çš„è¨˜éŒ„ï¼‰
- ç®¡ç†å“¡éœ€è¦å®Œæ•´çš„ç®¡ç†æ¬Šé™
- ç¬¦åˆåœ–æ›¸é¤¨å¯¦éš›ä½¿ç”¨æƒ…å¢ƒ

## Architecture

### è³‡æ–™æ¨¡å‹é—œä¿‚
```
res.partner (1) ----< (N) library.borrowing >---- (1) library.book
    - id                      - id                    - id
    - name                    - partner_id            - name
    - email                   - book_id               - quantity
    - phone                   - borrow_date           - available_quantity
                              - due_date              - borrowing_ids (One2many)
                              - return_date           - current_borrowing_id (Many2one)
                              - state                 - borrowed_count (computed)
                              - renew_count
                              - overdue_days (computed)
                              - is_overdue (computed)
                              - can_renew (computed)
```

### é—œéµæ¬„ä½å®šç¾©

#### library.borrowing
```python
# é—œè¯æ¬„ä½
partner_id = fields.Many2one('res.partner', string="å€Ÿé–±è€…", required=True, 
                             ondelete='restrict', index=True)
book_id = fields.Many2one('library.book', string="æ›¸ç±", required=True, 
                          ondelete='restrict', index=True)

# æ—¥æœŸæ¬„ä½
borrow_date = fields.Date(string="å€Ÿé–±æ—¥æœŸ", required=True, 
                          default=fields.Date.today, copy=False)
due_date = fields.Date(string="åˆ°æœŸæ—¥", required=True, copy=False)
return_date = fields.Date(string="æ­¸é‚„æ—¥æœŸ", copy=False, readonly=True)

# ç‹€æ…‹å’Œè¨ˆæ•¸
state = fields.Selection([
    ('draft', 'è‰ç¨¿'),
    ('borrowed', 'å€Ÿé–±ä¸­'),
    ('returned', 'å·²æ­¸é‚„'),
    ('cancelled', 'å·²å–æ¶ˆ'),
], string='ç‹€æ…‹', required=True, readonly=True, copy=False, 
   tracking=True, default='draft')

renew_count = fields.Integer(string="çºŒå€Ÿæ¬¡æ•¸", default=0, copy=False)

# è¨ˆç®—æ¬„ä½
overdue_days = fields.Integer(string="é€¾æœŸå¤©æ•¸", compute='_compute_overdue_days', 
                               store=True)
is_overdue = fields.Boolean(string="æ˜¯å¦é€¾æœŸ", compute='_compute_overdue_days', 
                             store=True)
can_renew = fields.Boolean(string="å¯å¦çºŒå€Ÿ", compute='_compute_can_renew')
```

#### library.book (æ“´å±•)
```python
# æ–°å¢æ¬„ä½
borrowing_ids = fields.One2many('library.borrowing', 'book_id', 
                                string="å€Ÿé–±è¨˜éŒ„", copy=False)
current_borrowing_id = fields.Many2one('library.borrowing', 
                                       string="ç•¶å‰å€Ÿé–±", copy=False,
                                       compute='_compute_current_borrowing', 
                                       store=True)
borrowed_count = fields.Integer(string="ç¸½å€Ÿé–±æ¬¡æ•¸", 
                                compute='_compute_borrowed_count', store=True)
```

## Risks / Trade-offs

### é¢¨éšª 1: åº«å­˜åŒæ­¥å•é¡Œ
- **é¢¨éšª**: ä¸¦ç™¼å€Ÿé–±å¯èƒ½å°è‡´åº«å­˜æ•¸é‡ä¸ä¸€è‡´
- **ç·©è§£**: 
  - ä½¿ç”¨è³‡æ–™åº«äº‹å‹™ç¢ºä¿åŸå­æ€§
  - åœ¨å€Ÿé–±å‰æª¢æŸ¥ä¸¦é–å®šè¨˜éŒ„
  - ä½¿ç”¨ Python ç´„æŸé©—è­‰åº«å­˜
  - æä¾›åº«å­˜æ ¡æ­£åŠŸèƒ½ï¼ˆç®¡ç†å“¡ï¼‰

### é¢¨éšª 2: é€¾æœŸè¨˜éŒ„ç´¯ç©
- **é¢¨éšª**: é•·æœŸé€¾æœŸçš„è¨˜éŒ„å¯èƒ½å½±éŸ¿ç³»çµ±æ•ˆèƒ½
- **ç·©è§£**:
  - ä½¿ç”¨ç´¢å¼•å„ªåŒ–æŸ¥è©¢
  - æä¾›é€¾æœŸæé†’åŠŸèƒ½
  - å®šæœŸæ­¸æª”èˆŠè¨˜éŒ„ï¼ˆæœªä¾†åŠŸèƒ½ï¼‰

### é¢¨éšª 3: çºŒå€Ÿè¦å‰‡è¤‡é›œåŒ–
- **é¢¨éšª**: æœªä¾†å¯èƒ½éœ€è¦æ›´è¤‡é›œçš„çºŒå€Ÿè¦å‰‡ï¼ˆå¦‚æª¢æŸ¥é ç´„ï¼‰
- **ç·©è§£**:
  - è¨­è¨ˆå¯æ“´å±•çš„çºŒå€Ÿæª¢æŸ¥æ©Ÿåˆ¶
  - ä½¿ç”¨é…ç½®è³‡æ–™è€Œéç¡¬ç·¨ç¢¼
  - ç‚ºæœªä¾†çš„é ç´„åŠŸèƒ½é ç•™ä»‹é¢

### æ¬Šè¡¡ 1: ç°¡å–® vs å®Œæ•´
- **é¸æ“‡**: ç°¡å–®çš„å€Ÿé–±ç®¡ç†ï¼ˆç„¡ç½°æ¬¾ã€ç„¡é ç´„ï¼‰
- **æ¬Šè¡¡**: çŠ§ç‰²äº†é€²éšåŠŸèƒ½
- **ç†ç”±**: ç¬¦åˆ MVP åŸå‰‡ï¼Œå…ˆå¯¦ä½œæ ¸å¿ƒåŠŸèƒ½ï¼Œå¾ŒçºŒå¯æ“´å±•

### æ¬Šè¡¡ 2: ä½¿ç”¨ res.partner vs ç¨ç«‹è®€è€…æ¨¡å‹
- **é¸æ“‡**: ä½¿ç”¨ Odoo æ¨™æº–çš„ res.partner
- **æ¬Šè¡¡**: ç„¡æ³•ç›´æ¥æ·»åŠ åœ–æ›¸é¤¨ç‰¹å®šçš„æœƒå“¡æ¬„ä½
- **ç†ç”±**: é™ä½è¤‡é›œåº¦ï¼Œå¯é€éç¹¼æ‰¿æ“´å±•
- **æœªä¾†**: å¯å»ºç«‹ `library.member` ç¹¼æ‰¿ `res.partner`

## Migration Plan

### åˆå§‹éƒ¨ç½²
1. æ›´æ–° `library_management` æ¨¡çµ„
2. ç³»çµ±è‡ªå‹•å»ºç«‹ `library_borrowing` è³‡æ–™è¡¨
3. ç¾æœ‰çš„ `library.book` è¨˜éŒ„ä¸å—å½±éŸ¿
4. è¨“ç·´åœ–æ›¸ç®¡ç†å“¡ä½¿ç”¨æ–°åŠŸèƒ½

### è³‡æ–™é·ç§»ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰
- å¦‚æœæœ‰èˆŠç³»çµ±çš„å€Ÿé–±è³‡æ–™ï¼Œæä¾›åŒ¯å…¥å·¥å…·
- ä½¿ç”¨ CSV åŒ¯å…¥ç¯„æœ¬
- é©—è­‰åŒ¯å…¥è³‡æ–™çš„å®Œæ•´æ€§

### å›æ»¾è¨ˆç•«
- å¦‚éœ€å›æ»¾ï¼Œå¯åœç”¨å€Ÿé–±åŠŸèƒ½æ¨¡çµ„
- æ›¸ç±è³‡æ–™ä¸å—å½±éŸ¿
- å€Ÿé–±è¨˜éŒ„ä¿ç•™åœ¨è³‡æ–™åº«ä¸­

## Open Questions

### å·²è§£æ±ºçš„å•é¡Œ
- âœ… **Q**: æ˜¯å¦éœ€è¦ç¨ç«‹çš„è®€è€…ç®¡ç†ï¼Ÿ
  - **A**: ç¬¬ä¸€ç‰ˆä½¿ç”¨ res.partnerï¼Œæœªä¾†å¯æ“´å±•

- âœ… **Q**: å€Ÿé–±æœŸé™å¦‚ä½•è¨­å®šï¼Ÿ
  - **A**: é è¨­ 14 å¤©ï¼Œå¯é…ç½®

- âœ… **Q**: çºŒå€Ÿå¦‚ä½•è¨ˆç®—ï¼Ÿ
  - **A**: å¾åŸåˆ°æœŸæ—¥å»¶é•·ï¼Œæœ€å¤š 2 æ¬¡

### å¾…ç¢ºèªçš„å•é¡Œ
- â³ **Q**: æ˜¯å¦éœ€è¦é€¾æœŸç½°æ¬¾åŠŸèƒ½ï¼Ÿ
  - **å»ºè­°**: ç¬¬ä¸€ç‰ˆä¸åŒ…å«ï¼Œæœªä¾†å¯æ·»åŠ 

- â³ **Q**: æ˜¯å¦éœ€è¦é ç´„åŠŸèƒ½ï¼Ÿ
  - **å»ºè­°**: ç¬¬ä¸€ç‰ˆä¸åŒ…å«ï¼Œä½œç‚ºç¨ç«‹è®Šæ›´å¯¦ä½œ

- â³ **Q**: æ˜¯å¦éœ€è¦å€Ÿé–±çµ±è¨ˆå’Œå ±è¡¨ï¼Ÿ
  - **å»ºè­°**: å¯åœ¨å¾ŒçºŒè®Šæ›´ä¸­æ·»åŠ 

- â³ **Q**: æ˜¯å¦éœ€è¦æ‰¹é‡å€Ÿé–±/æ­¸é‚„åŠŸèƒ½ï¼Ÿ
  - **å»ºè­°**: ç¬¬ä¸€ç‰ˆä¸åŒ…å«ï¼Œè©•ä¼°å¯¦éš›éœ€æ±‚å¾Œæ±ºå®š

## Implementation Notes

### å¿…é ˆéµå®ˆçš„è¦ç¯„
1. **è®€å–åŸå§‹ç¢¼**: å¯¦ä½œå‰ï¼Œå¿…é ˆè®€å– `sale` å’Œ `stock` æ¨¡çµ„çš„ç‹€æ…‹ç®¡ç†é‚è¼¯
2. **ä½¿ç”¨æ–°èªæ³•**: ä½¿ç”¨ `models.Constraint` è€ŒéèˆŠçš„ `_sql_constraints`
3. **å‘½åè¦ç¯„**: åš´æ ¼éµå®ˆ `model_name_view_type` æ ¼å¼
4. **ç¨‹å¼ç¢¼å“è³ª**: åŸ·è¡Œ `openspec validate --strict` ç¢ºä¿ç„¡éŒ¯èª¤

### åƒè€ƒæª”æ¡ˆ
- ç‹€æ…‹ç®¡ç†åƒè€ƒ: `sale/models/sale_order.py`
- è¡¨å–®è¦–åœ–åƒè€ƒ: `sale/views/sale_order_views.xml`
- è¨˜éŒ„è¦å‰‡åƒè€ƒ: `sale/security/sale_security.xml`

### æ¸¬è©¦é‡é»
1. å€Ÿé–±æ™‚åº«å­˜è‡ªå‹•æ‰£æ¸›
2. æ­¸é‚„æ™‚åº«å­˜è‡ªå‹•å¢åŠ 
3. çºŒå€Ÿæ¬¡æ•¸é™åˆ¶
4. é€¾æœŸè¨ˆç®—æ­£ç¢ºæ€§
5. æ¬Šé™æ§åˆ¶ï¼ˆä½¿ç”¨è€… vs ç®¡ç†å“¡ï¼‰
6. ä¸¦ç™¼å€Ÿé–±çš„åº«å­˜ä¸€è‡´æ€§
7. è¦–åœ–åœ¨ä¸åŒè§£æåº¦ä¸‹çš„é¡¯ç¤º

