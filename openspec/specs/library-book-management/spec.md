# library-book-management Specification

## Purpose
TBD - created by archiving change add-library-book-management. Update Purpose after archive.
## Requirements
### Requirement: 圖書基本資訊管理
系統 SHALL 提供完整的圖書基本資訊管理功能，包括新增、讀取、更新和刪除書籍記錄。

#### Scenario: 新增書籍成功
- **GIVEN** 使用者是圖書管理員
- **WHEN** 使用者填寫完整的書籍資訊（書名、ISBN、作者、分類、數量）
- **AND** ISBN 格式正確且未重複
- **AND** 數量為正整數
- **THEN** 系統成功建立書籍記錄
- **AND** 顯示成功訊息
- **AND** 書籍出現在書籍列表中

#### Scenario: 新增書籍失敗 - ISBN 重複
- **GIVEN** 使用者是圖書管理員
- **WHEN** 使用者嘗試新增書籍
- **AND** 輸入的 ISBN 已存在於系統中
- **THEN** 系統拒絕建立記錄
- **AND** 顯示錯誤訊息「此 ISBN 已存在」

#### Scenario: 新增書籍失敗 - ISBN 格式錯誤
- **GIVEN** 使用者是圖書管理員
- **WHEN** 使用者嘗試新增書籍
- **AND** 輸入的 ISBN 不符合 ISBN-10 或 ISBN-13 格式
- **THEN** 系統拒絕建立記錄
- **AND** 顯示錯誤訊息「ISBN 格式不正確」

#### Scenario: 編輯書籍資訊
- **GIVEN** 使用者是圖書管理員
- **AND** 系統中存在一本書籍
- **WHEN** 使用者修改書籍的任何資訊（如作者、出版社、數量）
- **AND** 修改後的資料符合驗證規則
- **THEN** 系統成功更新書籍記錄
- **AND** 顯示成功訊息
- **AND** 修改記錄在訊息追蹤中可見

#### Scenario: 刪除書籍
- **GIVEN** 使用者是圖書管理員
- **AND** 系統中存在一本書籍
- **AND** 該書籍沒有關聯的借閱記錄（未來功能）
- **WHEN** 使用者刪除該書籍
- **THEN** 系統成功刪除書籍記錄
- **AND** 書籍從列表中消失

#### Scenario: 一般使用者無法編輯書籍
- **GIVEN** 使用者是一般使用者（非管理員）
- **AND** 系統中存在一本書籍
- **WHEN** 使用者嘗試編輯或刪除書籍
- **THEN** 系統拒絕操作
- **AND** 顯示權限不足的錯誤訊息

### Requirement: 圖書分類管理
系統 SHALL 提供圖書分類管理功能，允許管理員建立和維護圖書分類體系。

#### Scenario: 建立圖書分類
- **GIVEN** 使用者是圖書管理員
- **WHEN** 使用者建立新的圖書分類
- **AND** 輸入分類名稱和唯一的分類代碼
- **THEN** 系統成功建立分類記錄
- **AND** 該分類可在新增書籍時選擇

#### Scenario: 分類代碼唯一性
- **GIVEN** 使用者是圖書管理員
- **WHEN** 使用者嘗試建立分類
- **AND** 輸入的分類代碼已存在
- **THEN** 系統拒絕建立記錄
- **AND** 顯示錯誤訊息「分類代碼必須唯一」

#### Scenario: 停用分類
- **GIVEN** 使用者是圖書管理員
- **AND** 系統中存在一個分類
- **WHEN** 使用者將分類設為停用
- **THEN** 該分類在新增書籍時不再顯示於選項中
- **AND** 已使用該分類的書籍仍保持關聯

#### Scenario: 刪除有書籍的分類
- **GIVEN** 使用者是圖書管理員
- **AND** 系統中存在一個分類
- **AND** 該分類下有書籍
- **WHEN** 使用者嘗試刪除該分類
- **THEN** 系統拒絕刪除操作
- **AND** 顯示錯誤訊息「無法刪除有書籍的分類」

### Requirement: 圖書庫存追蹤
系統 SHALL 追蹤每本書籍的總數量和可借閱數量，並根據借閱狀態自動更新可借閱數量。

#### Scenario: 設定書籍庫存
- **GIVEN** 使用者是圖書管理員
- **WHEN** 使用者新增或編輯書籍
- **AND** 設定總數量為 5
- **AND** 設定可借閱數量為 5
- **THEN** 系統記錄這些數量
- **AND** 書籍狀態顯示為「可借閱」

#### Scenario: 庫存數量驗證
- **GIVEN** 使用者是圖書管理員
- **WHEN** 使用者嘗試設定可借閱數量
- **AND** 可借閱數量大於總數量
- **THEN** 系統拒絕儲存
- **AND** 顯示錯誤訊息「可借閱數量不能大於總數量」

#### Scenario: 庫存數量非負驗證
- **GIVEN** 使用者是圖書管理員
- **WHEN** 使用者嘗試設定數量
- **AND** 數量為負數
- **THEN** 系統拒絕儲存
- **AND** 顯示錯誤訊息「數量必須為非負整數」

#### Scenario: 無庫存書籍顯示
- **GIVEN** 系統中存在一本書籍
- **AND** 該書籍的可借閱數量為 0
- **WHEN** 使用者查看書籍列表
- **THEN** 該書籍以特殊顏色標示（紅色）
- **AND** 狀態顯示為「無庫存」

#### Scenario: 有庫存書籍顯示
- **GIVEN** 系統中存在一本書籍
- **AND** 該書籍的可借閱數量大於 0
- **WHEN** 使用者查看書籍列表
- **THEN** 該書籍以正常顏色顯示（綠色）
- **AND** 狀態顯示為「可借閱」

#### Scenario: 借閱時自動扣減庫存
- **GIVEN** 系統中存在一本書籍，可借閱數量為 5
- **WHEN** 使用者執行借閱操作
- **THEN** 該書籍的可借閱數量自動減 1，變為 4
- **AND** 總數量保持不變
- **AND** 庫存變更記錄在訊息追蹤中

#### Scenario: 歸還時自動增加庫存
- **GIVEN** 系統中存在一本書籍，可借閱數量為 3
- **AND** 該書籍有一筆借閱中的記錄
- **WHEN** 使用者執行歸還操作
- **THEN** 該書籍的可借閱數量自動加 1，變為 4
- **AND** 總數量保持不變
- **AND** 庫存變更記錄在訊息追蹤中

#### Scenario: 取消借閱時恢復庫存
- **GIVEN** 系統中存在一本書籍，可借閱數量為 3
- **AND** 該書籍有一筆借閱中的記錄
- **WHEN** 使用者取消該借閱記錄
- **THEN** 該書籍的可借閱數量自動加 1，變為 4
- **AND** 總數量保持不變

### Requirement: 圖書資訊查詢
系統 SHALL 提供多維度的圖書查詢功能，包括書名、作者、ISBN、分類等。

#### Scenario: 依書名搜尋
- **GIVEN** 系統中存在多本書籍
- **WHEN** 使用者在搜尋框輸入書名關鍵字
- **THEN** 系統顯示所有書名包含該關鍵字的書籍
- **AND** 搜尋不區分大小寫

#### Scenario: 依作者搜尋
- **GIVEN** 系統中存在多本書籍
- **WHEN** 使用者在搜尋框輸入作者名稱
- **THEN** 系統顯示該作者的所有書籍

#### Scenario: 依 ISBN 搜尋
- **GIVEN** 系統中存在多本書籍
- **WHEN** 使用者在搜尋框輸入完整或部分 ISBN
- **THEN** 系統顯示 ISBN 匹配的書籍

#### Scenario: 依分類過濾
- **GIVEN** 系統中存在多本不同分類的書籍
- **WHEN** 使用者選擇特定分類的過濾器
- **THEN** 系統只顯示該分類的書籍

#### Scenario: 過濾有庫存書籍
- **GIVEN** 系統中存在有庫存和無庫存的書籍
- **WHEN** 使用者選擇「有庫存」過濾器
- **THEN** 系統只顯示可借閱數量大於 0 的書籍

#### Scenario: 過濾無庫存書籍
- **GIVEN** 系統中存在有庫存和無庫存的書籍
- **WHEN** 使用者選擇「無庫存」過濾器
- **THEN** 系統只顯示可借閱數量等於 0 的書籍

#### Scenario: 依分類分組顯示
- **GIVEN** 系統中存在多本不同分類的書籍
- **WHEN** 使用者選擇「依分類分組」
- **THEN** 系統將書籍依分類分組顯示
- **AND** 每個分組顯示該分類的書籍數量

### Requirement: 圖書資訊顯示
系統 SHALL 提供多種視圖模式（列表、表單、看板）來顯示圖書資訊。

#### Scenario: 列表視圖顯示
- **GIVEN** 使用者查看書籍列表
- **WHEN** 系統載入列表視圖
- **THEN** 顯示關鍵欄位：書名、ISBN、作者、分類、總數量、可借閱數量
- **AND** 可借閱數量為 0 的書籍以紅色標示
- **AND** 可借閱數量大於 0 的書籍以綠色標示
- **AND** 顯示總數量和可借閱數量的統計總和

#### Scenario: 表單視圖顯示
- **GIVEN** 使用者開啟一本書籍的詳細資訊
- **WHEN** 系統載入表單視圖
- **THEN** 顯示完整的書籍資訊
- **AND** 資訊分組顯示（基本資訊、庫存資訊、額外資訊）
- **AND** 使用分頁（Notebook）組織詳細資訊
- **AND** 顯示書籍封面圖片（如有）
- **AND** 底部顯示訊息追蹤區域（Chatter）

#### Scenario: 看板視圖顯示
- **GIVEN** 使用者切換到看板視圖
- **WHEN** 系統載入看板視圖
- **THEN** 以卡片形式顯示書籍
- **AND** 每張卡片顯示：封面圖片、書名、作者、庫存狀態
- **AND** 預設依分類分組顯示
- **AND** 卡片可拖曳以改變分類（管理員）

#### Scenario: 搜尋視圖功能
- **GIVEN** 使用者在任何視圖模式
- **WHEN** 使用者使用搜尋功能
- **THEN** 提供搜尋框（支援書名、作者、ISBN、出版社）
- **AND** 提供過濾器（有庫存、無庫存、依分類）
- **AND** 提供分組選項（依分類、依作者、依出版社）

### Requirement: 圖書資訊驗證
系統 SHALL 驗證所有輸入的圖書資訊，確保資料完整性和正確性。

#### Scenario: 必填欄位驗證
- **GIVEN** 使用者嘗試儲存書籍
- **WHEN** 必填欄位（書名、ISBN、作者、分類、數量）未填寫
- **THEN** 系統拒絕儲存
- **AND** 標示未填寫的欄位
- **AND** 顯示錯誤訊息「請填寫必填欄位」

#### Scenario: ISBN 格式驗證 - ISBN-10
- **GIVEN** 使用者輸入 ISBN
- **WHEN** ISBN 為 10 位數字格式
- **AND** 格式正確（可包含連字號）
- **THEN** 系統接受該 ISBN

#### Scenario: ISBN 格式驗證 - ISBN-13
- **GIVEN** 使用者輸入 ISBN
- **WHEN** ISBN 為 13 位數字格式
- **AND** 格式正確（可包含連字號）
- **THEN** 系統接受該 ISBN

#### Scenario: 數量範圍驗證
- **GIVEN** 使用者輸入數量
- **WHEN** 數量為正整數或 0
- **THEN** 系統接受該數量

### Requirement: 訊息追蹤
系統 SHALL 追蹤書籍資訊的所有變更，並提供訊息追蹤功能。

#### Scenario: 記錄欄位變更
- **GIVEN** 使用者是圖書管理員
- **AND** 系統中存在一本書籍
- **WHEN** 使用者修改書籍的關鍵欄位（如書名、作者、數量）
- **THEN** 系統在訊息追蹤中記錄變更
- **AND** 顯示變更的欄位、舊值、新值和變更時間
- **AND** 顯示變更者的使用者名稱

#### Scenario: 新增訊息
- **GIVEN** 使用者開啟書籍的表單視圖
- **WHEN** 使用者在 Chatter 區域新增訊息或註記
- **THEN** 系統儲存該訊息
- **AND** 訊息顯示在訊息追蹤中
- **AND** 可 @ 提及其他使用者

#### Scenario: 活動提醒
- **GIVEN** 使用者開啟書籍的表單視圖
- **WHEN** 使用者建立活動提醒（如「檢查庫存」）
- **THEN** 系統建立活動記錄
- **AND** 在到期時通知相關使用者

### Requirement: 權限控制
系統 SHALL 實作基於角色的權限控制，區分一般使用者和圖書管理員的操作權限。

#### Scenario: 管理員完整權限
- **GIVEN** 使用者屬於「Library Manager」群組
- **WHEN** 使用者存取圖書管理功能
- **THEN** 可以新增、讀取、更新、刪除書籍
- **AND** 可以管理圖書分類
- **AND** 可以修改庫存數量

#### Scenario: 一般使用者唯讀權限
- **GIVEN** 使用者屬於「Library User」群組
- **WHEN** 使用者存取圖書管理功能
- **THEN** 可以讀取和搜尋書籍資訊
- **AND** 無法新增、編輯或刪除書籍
- **AND** 無法管理圖書分類
- **AND** 嘗試編輯時顯示權限不足訊息

#### Scenario: 未授權使用者無法存取
- **GIVEN** 使用者不屬於任何圖書館相關群組
- **WHEN** 使用者嘗試存取圖書管理功能
- **THEN** 系統拒絕存取
- **AND** 選單中不顯示圖書管理相關項目

### Requirement: 預設資料
系統 SHALL 在安裝時提供預設的圖書分類資料，便於立即使用。

#### Scenario: 安裝模組後載入預設分類
- **GIVEN** 系統尚未安裝圖書管理模組
- **WHEN** 管理員安裝模組
- **THEN** 系統自動建立預設的圖書分類
- **AND** 預設分類包括：文學、科學、歷史、藝術、語言、數學、社會科學、自然科學等
- **AND** 每個分類都有唯一的分類代碼

#### Scenario: 預設分類可修改
- **GIVEN** 系統已載入預設分類
- **AND** 使用者是圖書管理員
- **WHEN** 使用者修改或刪除預設分類
- **THEN** 系統允許修改
- **AND** 不影響系統運作

### Requirement: 刪除書籍檢查
系統 SHALL 在刪除書籍前檢查是否有未歸還的借閱記錄。

#### Scenario: 刪除無借閱記錄的書籍
- **GIVEN** 使用者是圖書管理員
- **AND** 系統中存在一本書籍
- **AND** 該書籍沒有任何借閱記錄
- **WHEN** 使用者刪除該書籍
- **THEN** 系統成功刪除書籍記錄
- **AND** 書籍從列表中消失

#### Scenario: 刪除有已歸還借閱記錄的書籍
- **GIVEN** 使用者是圖書管理員
- **AND** 系統中存在一本書籍
- **AND** 該書籍有借閱記錄，但都已歸還
- **WHEN** 使用者刪除該書籍
- **THEN** 系統成功刪除書籍記錄
- **AND** 相關的借閱記錄保留（用於歷史追蹤）

#### Scenario: 無法刪除有未歸還借閱的書籍
- **GIVEN** 使用者是圖書管理員
- **AND** 系統中存在一本書籍
- **AND** 該書籍有借閱中（未歸還）的借閱記錄
- **WHEN** 使用者嘗試刪除該書籍
- **THEN** 系統拒絕刪除操作
- **AND** 顯示錯誤訊息「無法刪除有未歸還借閱的書籍」
- **AND** 提示使用者先處理未歸還的借閱記錄

### Requirement: 借閱統計資訊
系統 SHALL 在書籍資訊中顯示借閱統計資訊，包括總借閱次數和當前借閱狀態。

#### Scenario: 顯示總借閱次數
- **GIVEN** 使用者查看書籍列表或表單
- **AND** 該書籍有多筆借閱記錄（包括已歸還）
- **WHEN** 系統計算總借閱次數
- **THEN** 顯示該書籍被借閱的總次數
- **AND** 只計算狀態為「借閱中」或「已歸還」的記錄
- **AND** 不計算「草稿」或「已取消」的記錄

#### Scenario: 顯示當前借閱狀態
- **GIVEN** 使用者查看書籍表單
- **AND** 該書籍目前被借出（有借閱中的記錄）
- **WHEN** 系統顯示當前借閱資訊
- **THEN** 顯示「已借出」標記
- **AND** 顯示當前借閱者姓名
- **AND** 顯示預計歸還日期（到期日）
- **AND** 如已逾期，以紅色標示並顯示逾期天數

#### Scenario: 顯示可借閱狀態
- **GIVEN** 使用者查看書籍表單
- **AND** 該書籍目前未被借出（無借閱中的記錄）
- **AND** 可借閱數量大於 0
- **WHEN** 系統顯示借閱狀態
- **THEN** 顯示「可借閱」標記
- **AND** 顯示可借閱數量

#### Scenario: 統計按鈕顯示借閱次數
- **GIVEN** 使用者查看書籍表單
- **WHEN** 系統載入表單
- **THEN** 在 button_box 顯示統計按鈕
- **AND** 按鈕顯示總借閱次數
- **AND** 點擊按鈕可查看該書籍的所有借閱記錄

### Requirement: 快速借閱功能
系統 SHALL 在書籍表單中提供快速借閱按鈕，簡化借閱流程。

#### Scenario: 顯示快速借閱按鈕
- **GIVEN** 使用者是圖書管理員
- **AND** 開啟一本書籍的表單視圖
- **AND** 該書籍的可借閱數量大於 0
- **WHEN** 系統載入表單
- **THEN** 在 header 或 button_box 顯示「快速借閱」按鈕
- **AND** 按鈕為可用狀態

#### Scenario: 隱藏快速借閱按鈕 - 無庫存
- **GIVEN** 使用者開啟一本書籍的表單視圖
- **AND** 該書籍的可借閱數量為 0
- **WHEN** 系統載入表單
- **THEN** 快速借閱按鈕不顯示或為停用狀態
- **AND** 顯示「無庫存」提示

#### Scenario: 使用快速借閱按鈕
- **GIVEN** 使用者是圖書管理員
- **AND** 點擊書籍表單中的「快速借閱」按鈕
- **WHEN** 系統處理請求
- **THEN** 開啟新的借閱記錄表單
- **AND** 書籍欄位自動填入當前書籍
- **AND** 借閱日期自動設為今天
- **AND** 到期日自動計算
- **AND** 使用者只需選擇借閱者並確認

### Requirement: 借閱歷史顯示
系統 SHALL 在書籍表單中顯示完整的借閱歷史記錄。

#### Scenario: 查看借閱歷史分頁
- **GIVEN** 使用者開啟一本書籍的表單視圖
- **WHEN** 使用者切換到「借閱歷史」分頁（Notebook page）
- **THEN** 系統顯示該書籍的所有借閱記錄
- **AND** 使用內嵌列表視圖（One2many field）
- **AND** 顯示借閱者、借閱日期、到期日、歸還日期、狀態
- **AND** 依借閱日期排序（最新的在前）

#### Scenario: 空借閱歷史顯示
- **GIVEN** 使用者開啟一本從未被借閱的書籍表單
- **WHEN** 使用者切換到「借閱歷史」分頁
- **THEN** 顯示空列表
- **AND** 顯示提示訊息「此書籍尚未被借閱」

#### Scenario: 從借閱歷史開啟借閱記錄
- **GIVEN** 使用者在書籍表單的「借閱歷史」分頁
- **AND** 列表中有多筆借閱記錄
- **WHEN** 使用者點擊某筆借閱記錄
- **THEN** 系統開啟該借閱記錄的表單視圖
- **AND** 可查看完整的借閱詳情

